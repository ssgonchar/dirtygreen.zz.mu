#########################
#   mam.blog_biz_orders #
#########################
source mam_blog_biz_orders
{
    type            = mysql
    sql_host        = localhost
    sql_user        = mam
    sql_pass        = rdflhjcjan 
    sql_db          = mam_local
    sql_port        = 3306
    sql_query_pre   = SET NAMES utf8
    sql_query_pre   = REPLACE INTO sphinx_counters SELECT 'blog_biz_order', MAX(id), NOW() FROM orders
    sql_range_step  = 1000
#    sql_query_range = SELECT (SELECT MIN(id) FROM orders), (SELECT max_doc_id FROM sphinx_counters WHERE object_alias = 'blog_biz_order')
    sql_query       = \
		SELECT 25 * 100000000 * o.id + 25 * o.biz_id + 4 AS id \
	        , 4 AS entity_type \
	        , o.id AS entity_id \
	        , CONCAT('INPO', CONCAT(REPEAT('0', (4 - LENGTH(o.id))), o.id)) AS title \
	        , '' AS description \
	        , CRC32('biz') AS object_alias \
	        , o.biz_id AS object_id \
	        , 0 AS mailbox_id \
	        , o.created_at AS created_at \
	        , o.created_by AS created_by \
	        , 6 AS role_id \
	        , 0 AS message_sender_id \
	        , 0 AS message_recipient_id \
        FROM orders As o \
        WHERE o.biz_id > 0
    sql_attr_uint       = entity_type
    sql_attr_uint       = entity_id
    sql_attr_uint       = object_alias
    sql_attr_uint       = object_id
    sql_attr_uint       = mailbox_id
    sql_attr_timestamp  = created_at
    sql_attr_uint       = created_by
    sql_attr_uint       = role_id
    sql_attr_uint       = message_sender_id
    sql_attr_uint       = message_recipient_id

}

index ix_mam_blog_biz_orders
{
    source          = mam_blog_biz_orders
    path            = /var/lib/sphinx/mam_blog_biz_orders
    enable_star 	= 1
	min_word_len    = 2	
	min_infix_len 	= 3
    charset_type    = utf-8
}

source mam_blog_biz_orders_delta : mam_blog_biz_orders {
    type 			= mysql
    sql_query_pre 	= SET NAMES utf8
    sql_range_step 	= 1000
#    sql_query_range =
    sql_query       = \
		SELECT 25 * 100000000 * o.id + 25 * o.biz_id + 4 AS id \
	        , 4 AS entity_type \
	        , o.id AS entity_id \
	        , CONCAT('INPO', CONCAT(REPEAT('0', (4 - LENGTH(o.id))), o.id)) AS title \
	        , '' AS description \
	        , CRC32('biz') AS object_alias \
	        , o.biz_id AS object_id \
	        , 0 AS mailbox_id \
	        , o.created_at AS created_at \
	        , o.created_by AS created_by \
	        , 6 AS role_id \
	        , 0 AS message_sender_id \
	        , 0 AS message_recipient_id \
        FROM orders As o \
        WHERE o.biz_id > 0 \
        AND (o.id > (SELECT sc.max_doc_id FROM sphinx_counters AS sc WHERE sc.object_alias = 'blog_biz_orders') \
		OR o.modified_at >= (SELECT sc.last_reindex_at FROM sphinx_counters AS sc WHERE sc.object_alias = 'blog_biz_orders'))
}

index ix_mam_blog_biz_orders_delta : ix_mam_blog_biz_orders
{
    source          = mam_blog_biz_orders_delta
    path            = /var/lib/sphinx/mam_blog_biz_orders_delta
}


#########################
#   mam.blog_biz_ras    #
#########################
source mam_blog_biz_ras
{
    type            = mysql
    sql_host        = localhost
    sql_user        = mam
    sql_pass        = rdflhjcjan 
    sql_db          = mam_local
    sql_port        = 3306
    sql_query_pre   = SET NAMES utf8
    sql_query_pre   = REPLACE INTO sphinx_counters SELECT 'blog_biz_ra', MAX(id), NOW() FROM ra_items
    sql_range_step  = 1000
#    sql_query_range = SELECT (SELECT MIN(id) FROM ra_items), (SELECT max_doc_id FROM sphinx_counters WHERE object_alias = 'blog_biz_ra')
    sql_query       = \
		SELECT 25 * 100000000 * rai.id + 25 * o.biz_id + 5 AS id \
	        , 5 AS entity_type \
	        , ra.id AS entity_id \
	        , CONCAT('ra', CONCAT(REPEAT('0', (4 - LENGTH(ra.id))), ra.id), '/', YEAR(ra.created_at)) AS title \
	        , '' AS description \
	        , CRC32('biz') AS object_alias \
	        , o.biz_id AS object_id \
	        , 0 AS mailbox_id \
	        , ra.created_at AS created_at \
	        , ra.created_by AS created_by \
	        , 6 AS role_id \
	        , 0 AS message_sender_id \
	        , 0 AS message_recipient_id \
        FROM ra_items AS rai \
        INNER JOIN ra ON rai.ra_id = ra.id \
        INNER JOIN steelitems AS s ON s.id = rai.steelitem_id \
        INNER JOIN orders AS o ON o.id = s.order_id \
        WHERE o.biz_id > 0
    sql_attr_uint       = entity_type
    sql_attr_uint       = entity_id
    sql_attr_uint       = object_alias
    sql_attr_uint       = object_id
    sql_attr_uint       = mailbox_id
    sql_attr_timestamp  = created_at
    sql_attr_uint       = created_by
    sql_attr_uint       = role_id
    sql_attr_uint       = message_sender_id
    sql_attr_uint       = message_recipient_id

}

index ix_mam_blog_biz_ras
{
    source          = mam_blog_biz_ras
    path            = /var/lib/sphinx/mam_blog_biz_ras
    enable_star 	= 1
	min_word_len    = 2	
	min_infix_len 	= 3
    charset_type    = utf-8
}

source mam_blog_biz_ras_delta : mam_blog_biz_ras {
    type 			= mysql
    sql_query_pre 	= SET NAMES utf8
    sql_range_step 	= 1000
#    sql_query_range =
    sql_query       = \
		SELECT 25 * 100000000 * rai.id + 25 * o.biz_id + 5 AS id \
	        , 5 AS entity_type \
	        , ra.id AS entity_id \
	        , CONCAT('ra', CONCAT(REPEAT('0', (4 - LENGTH(ra.id))), ra.id), '/', YEAR(ra.created_at)) AS title \
	        , '' AS description \
	        , CRC32('biz') AS object_alias \
	        , o.biz_id AS object_id \
	        , 0 AS mailbox_id \
	        , ra.created_at AS created_at \
	        , ra.created_by AS created_by \
	        , 6 AS role_id \
	        , 0 AS message_sender_id \
	        , 0 AS message_recipient_id \
        FROM ra_items AS rai \
        INNER JOIN ra ON rai.ra_id = ra.id \
        INNER JOIN steelitems AS s ON s.id = rai.steelitem_id \
        INNER JOIN orders AS o ON o.id = s.order_id \
        WHERE o.biz_id > 0 \
        AND (rai.id > (SELECT sc.max_doc_id FROM sphinx_counters AS sc WHERE sc.object_alias = 'blog_biz_ras') \
		OR rai.modified_at >= (SELECT sc.last_reindex_at FROM sphinx_counters AS sc WHERE sc.object_alias = 'blog_biz_ras'))
}

index ix_mam_blog_biz_ras_delta : ix_mam_blog_biz_ras
{
    source          = mam_blog_biz_ras_delta
    path            = /var/lib/sphinx/mam_blog_biz_ras_delta
}

#########################
#   mam.blog_biz_ddts   #
#########################
source mam_blog_biz_ddts
{
    type            = mysql
    sql_host        = localhost
    sql_user        = mam
    sql_pass        = rdflhjcjan 
    sql_db          = mam_local
    sql_port        = 3306
    sql_query_pre   = SET NAMES utf8
    sql_query_pre   = REPLACE INTO sphinx_counters SELECT 'blog_biz_ddt', MAX(id), NOW() FROM ra_items
    sql_range_step  = 1000
#    sql_query_range = SELECT (SELECT MIN(id) FROM ra_items), (SELECT max_doc_id FROM sphinx_counters WHERE object_alias = 'blog_biz_ddt')
    sql_query       = \
		SELECT 25 * 100000000 * rai.id + 25 * o.biz_id + 6 AS id \
	        , 6 AS entity_type \
	        , ddt.id AS entity_id \
	        , CONCAT('ddt', CONCAT(REPEAT('0', (4 - LENGTH(ddt.id))), ddt.id), '/', YEAR(ddt.created_at)) AS title \
	        , '' AS description \
	        , CRC32('biz') AS object_alias \
	        , o.biz_id AS object_id \
	        , 0 AS mailbox_id \
	        , ddt.created_at AS created_at \
	        , ddt.created_by AS created_by \
	        , 6 AS role_id \
	        , 0 AS message_sender_id \
	        , 0 AS message_recipient_id \
        FROM ra_items AS rai \
        INNER JOIN ra ON rai.ra_id = ra.id \
        INNER JOIN ddt ON ddt.ra_id = ra.id \
        INNER JOIN steelitems AS s ON s.id = rai.steelitem_id \
        INNER JOIN orders AS o ON o.id = s.order_id \
        WHERE o.biz_id > 0
    sql_attr_uint       = entity_type
    sql_attr_uint       = entity_id
    sql_attr_uint       = object_alias
    sql_attr_uint       = object_id
    sql_attr_uint       = mailbox_id
    sql_attr_timestamp  = created_at
    sql_attr_uint       = created_by
    sql_attr_uint       = role_id
    sql_attr_uint       = message_sender_id
    sql_attr_uint       = message_recipient_id

}

index ix_mam_blog_biz_ddts
{
    source          = mam_blog_biz_ddts
    path            = /var/lib/sphinx/mam_blog_biz_ddts
    enable_star 	= 1
	min_word_len    = 2	
	min_infix_len 	= 3
    charset_type    = utf-8
}

source mam_blog_biz_ddts_delta : mam_blog_biz_ddts {
    type 			= mysql
    sql_query_pre 	= SET NAMES utf8
    sql_range_step 	= 1000
#    sql_query_range =
    sql_query       = \
		SELECT 25 * 100000000 * rai.id + 25 * o.biz_id + 6 AS id \
	        , 6 AS entity_type \
	        , ddt.id AS entity_id \
	        , CONCAT('ddt', CONCAT(REPEAT('0', (4 - LENGTH(ddt.id))), ddt.id), '/', YEAR(ddt.created_at)) AS title \
	        , '' AS description \
	        , CRC32('biz') AS object_alias \
	        , o.biz_id AS object_id \
	        , 0 AS mailbox_id \
	        , ddt.created_at AS created_at \
	        , ddt.created_by AS created_by \
	        , 6 AS role_id \
	        , 0 AS message_sender_id \
	        , 0 AS message_recipient_id \
        FROM ra_items AS rai \
        INNER JOIN ra ON rai.ra_id = ra.id \
        INNER JOIN ddt ON ddt.ra_id = ra.id \
        INNER JOIN steelitems AS s ON s.id = rai.steelitem_id \
        INNER JOIN orders AS o ON o.id = s.order_id \
        WHERE o.biz_id > 0 \
        AND (rai.id > (SELECT sc.max_doc_id FROM sphinx_counters AS sc WHERE sc.object_alias = 'blog_biz_ddts') \
		OR rai.modified_at >= (SELECT sc.last_reindex_at FROM sphinx_counters AS sc WHERE sc.object_alias = 'blog_biz_ddts'))
}

index ix_mam_blog_biz_ddts_delta : ix_mam_blog_biz_ddts
{
    source          = mam_blog_biz_ddts_delta
    path            = /var/lib/sphinx/mam_blog_biz_ddts_delta
}


#########################
#   mam.blog_biz_cmrs   #
#########################
source mam_blog_biz_cmrs
{
    type            = mysql
    sql_host        = localhost
    sql_user        = mam
    sql_pass        = rdflhjcjan 
    sql_db          = mam_local
    sql_port        = 3306
    sql_query_pre   = SET NAMES utf8
    sql_query_pre   = REPLACE INTO sphinx_counters SELECT 'blog_biz_cmr', MAX(id), NOW() FROM ra_items
    sql_range_step  = 1000
#    sql_query_range = SELECT (SELECT MIN(id) FROM ra_items), (SELECT max_doc_id FROM sphinx_counters WHERE object_alias = 'blog_biz_cmr')
    sql_query       = \
		SELECT 25 * 100000000 * rai.id + 25 * o.biz_id + 7 AS id \
	        , 7 AS entity_type \
	        , cmr.id AS entity_id \
	        , CONCAT('cmr', CONCAT(REPEAT('0', (4 - LENGTH(cmr.id))), cmr.id), '/', YEAR(cmr.created_at)) AS title \
	        , '' AS description \
	        , CRC32('biz') AS object_alias \
	        , o.biz_id AS object_id \
	        , 0 AS mailbox_id \
	        , cmr.created_at AS created_at \
	        , cmr.created_by AS created_by \
	        , 6 AS role_id \
	        , 0 AS message_sender_id \
	        , 0 AS message_recipient_id \
        FROM ra_items AS rai \
        INNER JOIN ra ON rai.ra_id = ra.id \
        INNER JOIN cmr ON cmr.ra_id = ra.id \
        INNER JOIN steelitems AS s ON s.id = rai.steelitem_id \
        INNER JOIN orders AS o ON o.id = s.order_id \
        WHERE o.biz_id > 0
    sql_attr_uint       = entity_type
    sql_attr_uint       = entity_id
    sql_attr_uint       = object_alias
    sql_attr_uint       = object_id
    sql_attr_uint       = mailbox_id
    sql_attr_timestamp  = created_at
    sql_attr_uint       = created_by
    sql_attr_uint       = role_id
    sql_attr_uint       = message_sender_id
    sql_attr_uint       = message_recipient_id

}

index ix_mam_blog_biz_cmrs
{
    source          = mam_blog_biz_cmrs
    path            = /var/lib/sphinx/mam_blog_biz_cmrs
    enable_star 	= 1
	min_word_len    = 2	
	min_infix_len 	= 3
    charset_type    = utf-8
}

source mam_blog_biz_cmrs_delta : mam_blog_biz_cmrs {
    type 			= mysql
    sql_query_pre 	= SET NAMES utf8
    sql_range_step 	= 1000
#    sql_query_range =
    sql_query       = \
		SELECT 25 * 100000000 * rai.id + 25 * o.biz_id + 7 AS id \
	        , 7 AS entity_type \
	        , cmr.id AS entity_id \
	        , CONCAT('cmr', CONCAT(REPEAT('0', (4 - LENGTH(cmr.id))), cmr.id), '/', YEAR(cmr.created_at)) AS title \
	        , '' AS description \
	        , CRC32('biz') AS object_alias \
	        , o.biz_id AS object_id \
	        , 0 AS mailbox_id \
	        , cmr.created_at AS created_at \
	        , cmr.created_by AS created_by \
	        , 6 AS role_id \
	        , 0 AS message_sender_id \
	        , 0 AS message_recipient_id \
        FROM ra_items AS rai \
        INNER JOIN ra ON rai.ra_id = ra.id \
        INNER JOIN cmr ON cmr.ra_id = ra.id \
        INNER JOIN steelitems AS s ON s.id = rai.steelitem_id \
        INNER JOIN orders AS o ON o.id = s.order_id \
        WHERE o.biz_id > 0 \
        AND (rai.id > (SELECT sc.max_doc_id FROM sphinx_counters AS sc WHERE sc.object_alias = 'blog_biz_cmrs') \
		OR rai.modified_at >= (SELECT sc.last_reindex_at FROM sphinx_counters AS sc WHERE sc.object_alias = 'blog_biz_cmrs'))
}

index ix_mam_blog_biz_cmrs_delta : ix_mam_blog_biz_cmrs
{
    source          = mam_blog_biz_cmrs_delta
    path            = /var/lib/sphinx/mam_blog_biz_cmrs_delta
}


#############################
#   mam.blog_biz_invoices   #
#############################
source mam_blog_biz_invoices
{
    type            = mysql
    sql_host        = localhost
    sql_user        = mam
    sql_pass        = rdflhjcjan 
    sql_db          = mam_local
    sql_port        = 3306
    sql_query_pre   = SET NAMES utf8
    sql_query_pre   = REPLACE INTO sphinx_counters SELECT 'blog_biz_invoice', MAX(id), NOW() FROM steelitems
    sql_range_step  = 1000
#    sql_query_range = SELECT (SELECT MIN(id) FROM steelitems), (SELECT max_doc_id FROM sphinx_counters WHERE object_alias = 'blog_biz_invoice')
    sql_query       = \
		SELECT 25 * 100000000 * s.id + 25 * o.biz_id + 8 AS id \
	        , 8 AS entity_type \
	        , inv.id AS entity_id \
	        , CONCAT('IVA', CONCAT(REPEAT('0', (4 - LENGTH(inv.id))), inv.id), '/', YEAR(inv.created_at)) AS title \
	        , '' AS description \
	        , CRC32('biz') AS object_alias \
	        , o.biz_id AS object_id \
	        , 0 AS mailbox_id \
	        , inv.created_at AS created_at \
	        , inv.created_by AS created_by \
	        , 6 AS role_id \
	        , 0 AS message_sender_id \
	        , 0 AS message_recipient_id \
        FROM steelitems AS s \
        INNER JOIN invoices AS inv ON inv.id = s.invoice_id \
        INNER JOIN orders AS o ON o.id = s.order_id \
        WHERE s.invoice_id > 0 AND o.biz_id > 0
    sql_attr_uint       = entity_type
    sql_attr_uint       = entity_id
    sql_attr_uint       = object_alias
    sql_attr_uint       = object_id
    sql_attr_uint       = mailbox_id
    sql_attr_timestamp  = created_at
    sql_attr_uint       = created_by
    sql_attr_uint       = role_id
    sql_attr_uint       = message_sender_id
    sql_attr_uint       = message_recipient_id

}

index ix_mam_blog_biz_invoices
{
    source          = mam_blog_biz_invoices
    path            = /var/lib/sphinx/mam_blog_biz_invoices
    enable_star 	= 1
	min_word_len    = 2	
	min_infix_len 	= 3
    charset_type    = utf-8
}

source mam_blog_biz_invoices_delta : mam_blog_biz_invoices {
    type 			= mysql
    sql_query_pre 	= SET NAMES utf8
    sql_range_step 	= 1000
#    sql_query_range =
    sql_query       = \
		SELECT 25 * 100000000 * s.id + 25 * o.biz_id + 8 AS id \
	        , 8 AS entity_type \
	        , inv.id AS entity_id \
	        , CONCAT('IVA', CONCAT(REPEAT('0', (4 - LENGTH(inv.id))), inv.id), '/', YEAR(inv.created_at)) AS title \
	        , '' AS description \
	        , CRC32('biz') AS object_alias \
	        , o.biz_id AS object_id \
	        , 0 AS mailbox_id \
	        , inv.created_at AS created_at \
	        , inv.created_by AS created_by \
	        , 6 AS role_id \
	        , 0 AS message_sender_id \
	        , 0 AS message_recipient_id \
        FROM steelitems AS s \
        INNER JOIN invoices AS inv ON inv.id = s.invoice_id \
        INNER JOIN orders AS o ON o.id = s.order_id \
        WHERE s.invoice_id > 0 AND o.biz_id > 0 \
        AND (s.id > (SELECT sc.max_doc_id FROM sphinx_counters AS sc WHERE sc.object_alias = 'blog_biz_invoices') \
		OR s.modified_at >= (SELECT sc.last_reindex_at FROM sphinx_counters AS sc WHERE sc.object_alias = 'blog_biz_invoices'))
}

index ix_mam_blog_biz_invoices_delta : ix_mam_blog_biz_invoices
{
    source          = mam_blog_biz_invoices_delta
    path            = /var/lib/sphinx/mam_blog_biz_invoices_delta
}



#############################
#   mam.blog_biz_sc         #
#############################
source mam_blog_biz_sc
{
    type            = mysql
    sql_host        = localhost
    sql_user        = mam
    sql_pass        = rdflhjcjan 
    sql_db          = mam_local
    sql_port        = 3306
    sql_query_pre   = SET NAMES utf8
    sql_query_pre   = REPLACE INTO sphinx_counters SELECT 'blog_biz_sc', MAX(id), NOW() FROM sc
    sql_range_step  = 1000
#    sql_query_range = SELECT (SELECT MIN(id) FROM sc), (SELECT max_doc_id FROM sphinx_counters WHERE object_alias = 'blog_biz_sc')
    sql_query       = \
		SELECT 25 * 100000000 * sc.id + 25 * o.biz_id + 9 AS id \
	        , 9 AS entity_type \
	        , sc.id AS entity_id \
	        , CONCAT('SC', CONCAT(REPEAT('0', (4 - LENGTH(sc.id))), sc.id), '/', YEAR(sc.created_at)) AS title \
	        , '' AS description \
	        , CRC32('biz') AS object_alias \
	        , o.biz_id AS object_id \
	        , 0 AS mailbox_id \
	        , sc.created_at AS created_at \
	        , sc.created_by AS created_by \
	        , 6 AS role_id \
	        , 0 AS message_sender_id \
	        , 0 AS message_recipient_id \
        FROM sc \
        INNER JOIN orders AS o ON o.id = sc.order_id \
        WHERE o.biz_id > 0
    sql_attr_uint       = entity_type
    sql_attr_uint       = entity_id
    sql_attr_uint       = object_alias
    sql_attr_uint       = object_id
    sql_attr_uint       = mailbox_id
    sql_attr_timestamp  = created_at
    sql_attr_uint       = created_by
    sql_attr_uint       = role_id
    sql_attr_uint       = message_sender_id
    sql_attr_uint       = message_recipient_id

}

index ix_mam_blog_biz_sc
{
    source          = mam_blog_biz_sc
    path            = /var/lib/sphinx/mam_blog_biz_sc
    enable_star 	= 1
	min_word_len    = 2	
	min_infix_len 	= 3
    charset_type    = utf-8
}

source mam_blog_biz_sc_delta : mam_blog_biz_sc {
    type 			= mysql
    sql_query_pre 	= SET NAMES utf8
    sql_range_step 	= 1000
#    sql_query_range =
    sql_query       = \
		SELECT 25 * 100000000 * sc.id + 25 * o.biz_id + 9 AS id \
	        , 9 AS entity_type \
	        , sc.id AS entity_id \
	        , CONCAT('SC', CONCAT(REPEAT('0', (4 - LENGTH(sc.id))), sc.id), '/', YEAR(sc.created_at)) AS title \
	        , '' AS description \
	        , CRC32('biz') AS object_alias \
	        , o.biz_id AS object_id \
	        , 0 AS mailbox_id \
	        , sc.created_at AS created_at \
	        , sc.created_by AS created_by \
	        , 6 AS role_id \
	        , 0 AS message_sender_id \
	        , 0 AS message_recipient_id \
        FROM sc \
        INNER JOIN orders AS o ON o.id = sc.order_id \
        WHERE o.biz_id > 0 \
        AND (sc.id > (SELECT sc2.max_doc_id FROM sphinx_counters AS sc2 WHERE sc2.object_alias = 'blog_biz_sc') \
		OR sc.modified_at >= (SELECT sc2.last_reindex_at FROM sphinx_counters AS sc2 WHERE sc2.object_alias = 'blog_biz_sc'))
}

index ix_mam_blog_biz_sc_delta : ix_mam_blog_biz_sc
{
    source          = mam_blog_biz_sc_delta
    path            = /var/lib/sphinx/mam_blog_biz_sc_delta
}
