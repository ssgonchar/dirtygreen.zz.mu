RA:
- на странице просмотра для пустых значений должно выводиться "not defined"
	сейчас не выводится для Truck Number, Destination, Loading Date, DDT Instructions, Marking Requirements, Dunnaging Requirements
	
- то, что находится в FillRAInfo после "// Итеграция с данными Заказа" нужно убрать
	данные для Consignee и Consignee Ref. нужно добавлять в поля ra.consignee, ra.consignee_ref
	только на этапе создания RA, чтобы потом была возможность эти данные подредактировать в RA
	в том числе и удалить вовсе.
	
- в поле Consignee выводятся не все данные, в нашем примере выводится только "mr." а имя человека не выводится
	нужно проверять, если имя и фамилия не заданы, не выводить "mr." и телефоны

- при изменении значимых полей (которые в дальнейшем используются в DDT и CMR) нужно перегенерировать PDF связанных документов


RA PDF:
- создаем RA из заказа для МаМ (1913), владелец листа MaM IT, стокхолдер европейский (Midolini, Udine), а выводится шапка PlatesAhead

- нужно немного разрядить информацию выводимую после списка айтемов


CMR:
- номер CMR должен быть следующего формата: если меньше 10, добивается 0, если больше 10, ставится как есть:
	02/2012, 12/2012, 122/2012

	
CMR PDF:
- поле 22: добавить печать и подпись (пришлют на днях, нужно озадачить Кирилла или Ксюшу)

- поле 21: отодвинуть блок дат к правому краю, растянуть поле для вывода города

- поле 3: выводить {ra.destination}

- сделать жирный шрифт для выводимых в PDF данных


Packing List PDF:
- бизнес приблизить к Our Ref. и разделить двоеточием - "Our Ref. : BIZ3123"

- CUSTOMER - выводить только название компании

- LOCATION - выводить {city}, {country}

- в таблице айтемов показывается неправильный Weight, туда должен идти взвешенный вес

- WEIGHBRIDGE WEIGHT - неправильный взвешенный вес


Я думаю мы сможем обойтись без ddt_items, cmr_items, используя только ra_items, как ты предложил.
Нужно:
- добавить ra_items.weighed_weight DECIMAL(10, 4)
- айтемы для документов выбирать: 
	PROCEDURE sp_ddt_get_items(IN param_ddt_id INT)
	BEGIN

		DECLARE var_ra_id 		INT DEFAULT 0;
		DECLARE var_owner_id 	INT DEFAULT 0;
		
		SELECT
			ra_id,
			owner_id
		INTO
			var_ra_id,
			var_owner_id
		FROM ddt
		WHERE id = param_ddt_id;
	
		SELECT 
			steelitems.*, 
			ra_items.weighed_weight 
		FROM ra_items
		JOIN steelitems ON steelitems.id = ra_items.steelitem_id
		WHERE ra_id = var_ra_id
		AND owner_id = var_owner_id;

	END
	
Взвешенный вес в RA задается на все айтемы, поэтому общий взвешеннй вес для каждого документа (IT, UK) 
нужно будет суммировать по weighed_weight для айтемов этого документа.

Вроде все сходится, но есть одна проблема - как реагировать на внешние изменения steelitem.owner_id 
за пределами RA, например при редактировании айтема?
Такое изменение приведет к тому что некоторые документы DDT, CMR могут стать неактуальными.
Мое решение: 
- добавить ra.is_outdated TINYINT 

- повесить на триггер при изменении айтема (t_steelitem_update):
	IF old.owner_id != new.owner_id
	THEN
		
		UPDATE ra
		SET
			is_outdated = 1
		WHERE id IN (
			SELECT 
				ra_id
			FROM ra_items
			WHERE parent_id = 0
			AND steelitem_id = new.id
		);
		
	END IF;

- на странице списка DDT проверять если ra.is_outdated = 1 выделять красным, прятать ссылку на PDF, 
	вместо нее покаывать картинку arrow-circle-double-135.png с ссылкой /ddt/{id}/update

- на странице списка CMR проверять если ra.is_outdated = 1 выделять красным, прятать ссылку на PDF, 
	вместо нее покаывать картинку arrow-circle-double-135.png с ссылкой /cmr/{id}/update
	
- в /cmr/{id}/update или /ddt/{id}/update нужно получить список айтемов для документа, если айтемов нет, то
	установить флаг is_deleted = 1, если айтемы есть, то перегенерировать документ и вернуться на страницу 
	списка документов. Можно эту функциональность сделать с помощью AJAX.
	
- со страницы просмотра DDT или CMR, если ra.is_outdated = 1 перенаправлять на страницу 
	/cmr/{id}/viewupdate или /ddt/{id}/viewupdate, которая делает тоже самое что и /update, но только
	потом возвращает на страницу просмотра документа
	
- при /update или /viewupdate нужно перегенерировать все связанные с RA документы, чтобы можно было
	установить флаг ra.is_outdated = 0. 
	
- думаю нужно написать метод в модели RA для перегенерации всех связанных документом, потому что он будет 
	вызываться и из самого RA, при изменении списка айтемов.
	

Подумай, пожалуйста, какие еще могут возникнуть проблемы при отказе от ddt_items и cmr_items,
а так же подумай над альтернативным вариантом решения проблемы устаревания RA.
